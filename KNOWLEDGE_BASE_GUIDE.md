# 📚 知识库增强功能使用指南

## 🎯 功能概述

知识库增强功能允许用户上传文档来提升AI需求分析的专业性和准确性。上传的文档会被永久保存，重启应用后仍然可用。

## ✨ 主要特性

### 🔄 永久存储
- 文档上传后永久保存在本地 `rag_storage/` 目录
- 重启应用后自动加载历史文档
- 支持文档元数据管理（文件名、大小、类型、上传时间等）

### 🚫 重复检测
- 基于内容哈希值（MD5）自动检测重复文档
- 防止相同内容的文档重复添加
- 智能提醒用户存在相似内容

### 📄 多格式支持
- **TXT** - 纯文本文件
- **PDF** - PDF文档（需要 `pypdf` 库）
- **DOCX** - Microsoft Word文档（需要 `docx2txt` 库）
- **DOC** - 旧版Word文档（需要 `docx2txt` 库）

### 🧠 智能增强
- LightRAG集成提供高级知识库查询
- 基本模式支持（无需LightRAG也可使用）
- 自动回退机制确保功能可用性

## 🚀 使用方法

### 📤 上传文档

#### 方法1：欢迎页面上传
1. 启动应用后，在主页面找到"📚 Build Knowledge Base"部分
2. 点击上传区域或拖放文件
3. 选择支持的文件格式（TXT、PDF、DOCX、DOC）
4. 点击"🔄 Process Documents"按钮
5. 系统将显示处理结果和知识库状态

#### 方法2：侧边栏管理
1. 查看侧边栏"🧠 Knowledge Base"部分
2. 查看当前知识库摘要信息
3. 展开"📁 Manage Documents"查看所有文档
4. 可以删除不需要的文档或重建知识库

### 📊 状态监控

#### 知识库状态指示器
- **🟢 LightRAG Enabled** - 高级功能完全可用
- **🟡 Basic Mode** - 基础功能可用，建议安装LightRAG
- **🔴 Not Available** - 功能暂时不可用

#### 文档摘要信息
- **总文档数** - 已上传文档的数量
- **总大小** - 所有文档的总大小（MB）
- **文件类型** - 包含的文档类型统计
- **最近上传** - 最新文档的上传时间

### 🗑️ 文档管理

#### 删除文档
1. 在侧边栏展开"📁 Manage Documents"
2. 找到要删除的文档
3. 点击文档旁边的"🗑️"按钮
4. 确认删除操作

#### 重建知识库
1. 在文档管理部分点击"🔄 Rebuild Knowledge Base"
2. 系统将重新加载所有文档到LightRAG
3. 适用于LightRAG更新或数据损坏情况

## 🛠️ 技术实现

### 文件存储结构
```
rag_storage/
├── documents/                 # 实际文档文件存储
│   └── 20250604_163230_filename.txt
├── documents_metadata.json    # 文档元数据
└── [LightRAG相关文件]         # 向量数据库文件
```

### 元数据格式
```json
{
  "documents": [
    {
      "filename": "example.txt",
      "content_hash": "md5hash",
      "upload_time": "2025-06-04T16:32:30.324045",
      "file_size": 1024,
      "file_type": "txt",
      "content_preview": "文档内容预览..."
    }
  ],
  "last_updated": "2025-06-04T16:32:30.324045"
}
```

### 重复检测机制
- 计算文档内容的MD5哈希值
- 与现有文档哈希值对比
- 发现重复时提示用户并拒绝上传

## 🔧 配置要求

### 基础要求
- Python 3.8+
- Streamlit
- 本项目的核心依赖

### 可选增强（推荐）
```bash
# PDF支持
pip install pypdf

# Word文档支持  
pip install docx2txt

# LightRAG高级功能
pip install lightrag-hku
```

## 📝 使用示例

### 示例1：上传技术文档
```
文件：system_architecture.pdf
内容：系统架构设计文档
效果：AI分析需求时会考虑架构约束和技术选型
```

### 示例2：上传业务需求
```
文件：business_requirements.docx  
内容：详细的业务流程和规则
效果：增强需求分析的业务合理性和完整性
```

### 示例3：上传最佳实践
```
文件：development_guidelines.txt
内容：开发规范和最佳实践
效果：提供符合规范的需求建议
```

## ⚠️ 注意事项

### 文件处理
- 大文件上传可能需要较长时间
- PDF文件需要可提取文本（非图片PDF）
- Word文档建议使用较新的格式（DOCX）

### 存储空间
- 文档将永久存储在本地，注意磁盘空间
- 可通过文档管理功能删除不需要的文档
- 定期清理可节省存储空间

### 性能考虑
- 文档数量过多可能影响查询性能
- 建议根据项目需要精选相关文档
- 大量文档时考虑分类管理

## 🔍 故障排除

### 常见问题

#### 问题1：上传失败
**原因**：文件格式不支持或文件损坏
**解决**：检查文件格式，尝试重新保存文件

#### 问题2：重复文档警告
**原因**：上传了相同或相似内容的文档
**解决**：检查现有文档，避免重复上传

#### 问题3：LightRAG功能不可用
**原因**：未安装LightRAG或安装失败
**解决**：运行 `pip install lightrag-hku`

#### 问题4：历史文档丢失
**原因**：元数据文件损坏或误删
**解决**：检查 `rag_storage/documents_metadata.json` 文件

### 日志查看
应用运行时会输出相关日志信息：
- 文档加载状态
- 处理成功/失败信息
- 错误详情和建议

## 🎉 最佳实践

1. **按项目分类** - 为不同项目上传相关文档
2. **内容精选** - 上传高质量、相关性强的文档
3. **定期维护** - 清理过时或无关的文档
4. **备份重要文档** - 定期备份 `rag_storage` 目录
5. **测试验证** - 上传后测试AI分析效果

---

📚 通过合理使用知识库功能，您可以大大提升AI需求分析的专业性和准确性！ 